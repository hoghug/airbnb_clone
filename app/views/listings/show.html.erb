<div class="row">
  <div class="col-md-6">
    <h1><%= @listing.address %></h1>

    <p><%= @listing.description %></p>
    <%# BREAK %>
    <p><%= render 'layouts/errors', object: @reservation %></p>

    <%= link_to 'Book It', '#', class: 'btn btn-danger', data: { toggle: 'modal', target: '#makeReservation'} %>

  </div>
  <div class="col-md-3">
    Details:
    <ul>
      <li>Bed(s): <%= @listing.bed_type %></li>
      <li>Room(s): <%= @listing.room_type %></li>
      <li>Bedroom(s): <%= @listing.bedroom_count %></li>
      <li>Bathroom(s): <%= @listing.bathroom_count %></li>
    </ul>
  </div>
  <div class="col-md-3">
    Rates:
    <ul>
      <li>Daily: $<%= @listing.nightly_rate.to_i %></li>
      <li>Weekly: $<%= @listing.weekly_rate.to_i %></li>
      <li>Monthy: $<%= @listing.monthly_rate.to_i %></li>
    </ul>
  </div>
</div>
<hr>
<div class="row">
  <div id="listing-tags" class="col-lg-12">
      <ul>
        <% @tags.each do |tag| %>
            <li><%= link_to tag.amenity.name, amenity_tag_path(tag.amenity, tag), remote: true,  method: 'delete', id: "destroy-am-#{tag.id}" %></li>
        <% end %>
      </ul>
  </div>
</div>
<hr>
<div class="row">
  <div id="photos" class="col-lg-12">
    <% @listing.photos.each do |photo| %>
      <%= image_tag photo.picture.url(:thumb) %>
    <% end %>
  </div>
</div>
<div class="row">
  <div id="calendar" class="col-lg-12">
    <div class="day-header">Sunday</div><div class="day-header">Monday</div><div class="day-header">Tuesday</div><div class="day-header">Wednesday</div><div class="day-header">Thursday</div><div class="day-header">Friday</div><div class="day-header">Saturday</div>
    <%
      month = Date.today.strftime("%m").to_i
      this_month_bookings = @reservations.select { |res| (res.checkin.strftime("%m").to_i) == month }
      days = Time.days_in_month(Date.today.strftime("%m").to_i, Date.today.strftime("%Y").to_i) + Date.today.wday
      counter = 0
      for i in 1..days do
    %>
      <div class="day-box" id="day-<%= i %>">
        <% if i >= Date.today.wday + 1 %>
          <% counter += 1 %>
          <span class="day-num"><%= counter %></span>
        <% end %>

        <% this_month_bookings.each do |booking| %>
          <% days_booked = []
            booking.checkin.strftime("%d").to_i.upto(booking.checkout.strftime("%d").to_i) {|i| days_booked << i }
          %>
          <% if days_booked.include?(counter) %>
              <span="booking">Booked</span>
          <% end %>
        <% end %>
      </div>
    <% end %>

  </div>
</div>
<div class="clear"></div>




<hr>
<% if current_user.id == @listing.user_id %>
  <div class="row">
    <div class="col-md-4">
      <%= form_for [@user, @listing, @photo], remote: true, authenticity_token: true, html: { :multipart => true } do |f| %>
        <div class="form-group">
          <%= f.label :picture, "Add a Photo" %>
          <%= f.file_field :picture, class: 'form-control' %>
        </div>
        <%= f.submit 'Submit', class: 'btn btn-info' %>
      <% end %>
    </div>
    <div class="col-md-2">
      <%= link_to 'Edit Listing', edit_user_listing_path(current_user, @listing) %>
    </div>
    <div class="col-md-6"  id="add-amenities">
      Add Amenities:
      <ul>
        <% @amenities.each do |am| %>
          <li><%= link_to am.name, amenity_tags_path(am, :listing_id => @listing.id), method: 'post', id: "am-#{am.id}", remote: true %></li>
        <% end %>
      </ul>
    </div>
  </div>
<% end %>



<div class="modal fade" id="makeReservation" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="myModalLabel">Make Reservation</h4>
        </div>
        <div class="modal-body">
          <%= form_for [@user, @listing, @reservation], :role => 'form' do |f| %>
            <%= f.hidden_field :user_id, value: current_user.id %>
            <div class="form-group">
              <%= f.label :checkin, 'Check In Date:' %>
              <%= f.date_field :checkin, class: 'form-control' %>
            </div>
            <div class="form-group">
              <%= f.label :checkout, 'Check Out Date:' %>
              <%= f.date_field :checkout, class: 'form-control' %>
            </div>
            <%= f.submit 'Submit', class: "btn btn-primary" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>


